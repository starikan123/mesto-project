(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup__opened")}function n(e){e.classList.remove("popup__opened"),document.removeEventListener("keydown",o)}function o(e){"Escape"===e.key&&n(document.querySelector(".popup__opened"))}e.d({},{R:()=>b});var r={baseUrl:"https://nomoreparties.co/v1/plus-cohort-18",headers:{authorization:"abe1d7ae-ecc9-47d5-a35f-74536599426e","Content-Type":"application/json"}};function c(e){return e.ok?e.json():Promise.reject(e.status)}function u(){return fetch("".concat(r.baseUrl,"/cards"),{method:"GET",headers:r.headers}).then((function(e){return c(e)}))}function a(e,t){t?e.textContent="Сохранение...":e.id?e.textContent="Создать":e.textContent="Сохранить"}function i(e,t,n,o){t.textContent=o.name,n.textContent=o.about,e.src=o.avatar}var l=document.querySelector(".profile__avatar"),s=document.querySelector(".popup_card-add"),d=document.querySelector(".popup_image-zoom"),p=document.querySelector("#card-template").content,f=document.querySelector(".popup__caption"),m=document.querySelector("#popupProfileAddButton"),_=s.querySelector(".popup__form-field[name=placeName-input]"),v=s.querySelector(".popup__form-field[name=placeUrl-input]");function h(e,t){return 1===t.filter((function(t){return t._id==e})).length}function y(e,n,o,u,a,i){var s=p.querySelector(".element").cloneNode(!0),m=s.querySelector(".element__like-button"),_=s.querySelector(".element__like-counter");_.textContent=a.length,h(u,a)&&m.classList.add("element__like-button_active"),m.addEventListener("click",(function(e){h(u,a)?function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:r.headers}).then((function(e){return c(e)}))}(i).then((function(t){_.textContent=t.likes.length,e.target.classList.toggle("element__like-button_active"),a=t.likes})).catch((function(e){console.log("Что-то пошло не так. Ошбика: ".concat(e))})):function(e){return fetch("".concat(r.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:r.headers}).then((function(e){return c(e)}))}(i).then((function(t){_.textContent=t.likes.length,e.target.classList.toggle("element__like-button_active"),a=t.likes})).catch((function(e){console.log("Что-то пошло не так. Ошбика: ".concat(e))}))}));var v=s.querySelector(".element__delete-button");u==o?v.addEventListener("click",(function(){var e=v.closest(".element");(function(e){return fetch("".concat(r.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:r.headers}).then((function(e){return c(e)}))})(i).then((function(){return e.remove()})).catch((function(e){console.log("Что-то пошло не так. Ошбика: ".concat(e))}))})):v.remove();var y=s.querySelector(".element__image");return y.addEventListener("click",(function(){t(d),l.src=n,l.alt="Фото ".concat(e),f.textContent=e})),s.querySelector(".element__info").textContent=e,y.src=n,y.setAttribute("alt","Фото ".concat(e)),s}m.addEventListener("submit",(function(e){var t,o;e.preventDefault(),a(e.submitter,!0),(t=_.value,o=v.value,fetch("".concat(r.baseUrl,"/cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:"".concat(t),link:"".concat(o)})}).then((function(e){return c(e)}))).then((function(e){b.prepend(y(e.name,e.link,e.owner._id,e.owner._id,e.likes,e._id)),n(s),m.reset()})).catch((function(e){console.log("Что-то пошло не так. Ошбика: ".concat(e))})).finally((function(){setTimeout((function(){a(e.submitter,!1)}),300)}))}));var S,b=document.querySelector(".elements"),q=document.querySelector(".profile"),g=q.querySelector(".profile__edit-button"),E=document.querySelector(".popup_profile-edit"),L=document.querySelector("#avatar-change"),k=document.querySelector(".popup_form_layout"),C=Array.from(document.querySelectorAll(".popup")),A=q.querySelector(".profile__add-button"),x=(document.querySelector("#popupProfileEditForm"),document.querySelector("#profile__name-input")),T=document.querySelector("#profile__description-input"),U=document.querySelector("#profile__name"),P=document.querySelector("#profile__description"),w=(document.querySelector("#placeName-input"),document.querySelector("#placeUrl-input"),document.querySelector(".profile__avatar-change-button")),O=(document.querySelector(".profile__avatar"),document.querySelector("#avatar-change")),B=k.querySelector(".popup__form-field[name=placeAvatar-change-input]"),D=(document.querySelector("#addCardSubmitBtn"),document.querySelectorAll(".popup__close-button"));fetch("".concat(r.baseUrl,"/users/me"),{method:"GET",headers:r.headers}).then((function(e){return c(e)})).then((function(e){i(l,U,P,e);var t=e._id;u().then((function(e){!function(e,t,n){var o=new Set;t.forEach((function(t){o.has(t._id)||(o.add(t._id),e.prepend(y(t.name,t.link,t.owner._id,n,t.likes,t._id)))}))}(b,e,t)})).catch((function(e){console.log("Что-то пошло не так. Ошбика: ".concat(e))}))})),D.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return n(t)}))})),document.addEventListener("keyup",o),g.addEventListener("click",(function(){t(E)})),C.forEach((function(e){addEventListener("mousedown",(function(t){t.target.classList.contains("popup__opened")&&n(e),t.target.classList.contains("popup__close-button")&&n(e)}))})),g.addEventListener("click",(function(){t(E),x.value=U.innerText,T.value=P.innerText})),popupProfileEditForm.addEventListener("submit",(function(e){var t,o;e.preventDefault(),a(e.submitter,!0),(t=x.value,o=T.value,fetch("".concat(r.baseUrl,"/users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:"".concat(t),about:"".concat(o)})}).then((function(e){return c(e)}))).then((function(e){i(l,U,P,e),n(E)})).catch((function(e){console.log("Что-то пошло не так. Ошбика: ".concat(e))})).finally((function(){setTimeout((function(){a(e.submitter,!1)}),300)}))})),A.addEventListener("click",(function(){t(s)})),w.addEventListener("click",(function(){t(L)})),O.addEventListener("submit",(function(e){var t;e.preventDefault(),a(e.submitter,!0),(t=B.value,fetch("".concat(r.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:"".concat(t)})}).then((function(e){return c(e)}))).then((function(t){i(l,U,P,t),n(L),e.target.reset()})).catch((function(e){console.log("Что-то пошло не так. Ошбика: ".concat(e))})).finally((function(){setTimeout((function(){a(e.submitter,!1)}),300)}))})),S={formSelector:".popup__form",inputSelector:".popup__form-field",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_notActive",inputErrorClass:"popup__eror-masage",errorClass:"popup__eror-masage_active"},document.querySelectorAll(S.formSelector).forEach((function(e){e.setAttribute("novalidate",!0),function(e,t,n){Array.from(e.querySelectorAll(".popup__form-field")).forEach((function(o){o.addEventListener("input",(function(){(function(e,t,n){var o,r=e.querySelector(t);o=e.querySelectorAll(".popup__form-field"),Array.prototype.some.call(o,(function(e){return!1===e.validity.valid}))?(r.classList.add(n),r.setAttribute("disabled",!0)):(r.classList.remove(n),r.removeAttribute("disabled"))})(e,t,n),function(e,t){t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));n.classList.remove("popup__eror-masage"),n.textContent="",n.classList.remove("popup__eror-masage_active"),t.classList.remove("popup__form-field_type_error")}(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.add("popup__eror-masage"),""===t.value?o.textContent="Вы пропустили это поле":o.textContent=n,o.classList.add("popup__eror-masage_active")}(e,t,t.validationMessage)}(e,o)}))})),e.addEventListener("submit",(function(e){e.preventDefault()}))}(e,S.submitButtonSelector,S.inactiveButtonClass)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SCxFQUFLbkUsaUJBQWlCLFVBQVUsU0FBQ2tGLEdBQy9CQSxFQUFNaEUsZ0JBQ1IsR0FDRixDQVNJaUUsQ0FDRWhCLEVBQ0F2QyxFQUEwQm1DLHFCQUMxQm5DLEVBQTBCb0Msb0JBRTlCLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly95YW5kZXgucHJha3Rpa3VtL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL3lhbmRleC5wcmFrdGlrdW0vd2VicGFjay9ydW50aW1lL2RlZmluZSBwcm9wZXJ0eSBnZXR0ZXJzIiwid2VicGFjazovL3lhbmRleC5wcmFrdGlrdW0vd2VicGFjay9ydW50aW1lL2hhc093blByb3BlcnR5IHNob3J0aGFuZCIsIndlYnBhY2s6Ly95YW5kZXgucHJha3Rpa3VtLy4vc3JjL2NvbXBvbmVudHMvbW9kYWwuanMiLCJ3ZWJwYWNrOi8veWFuZGV4LnByYWt0aWt1bS8uL3NyYy9jb21wb25lbnRzL2FwaS5qcyIsIndlYnBhY2s6Ly95YW5kZXgucHJha3Rpa3VtLy4vc3JjL2NvbXBvbmVudHMvdXRpbHMuanMiLCJ3ZWJwYWNrOi8veWFuZGV4LnByYWt0aWt1bS8uL3NyYy9jb21wb25lbnRzL2NhcmQuanMiLCJ3ZWJwYWNrOi8veWFuZGV4LnByYWt0aWt1bS8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly95YW5kZXgucHJha3Rpa3VtLy4vc3JjL2NvbXBvbmVudHMvdmFsaWRhdGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gVGhlIHJlcXVpcmUgc2NvcGVcbnZhciBfX3dlYnBhY2tfcmVxdWlyZV9fID0ge307XG5cbiIsIi8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb25zIGZvciBoYXJtb255IGV4cG9ydHNcbl9fd2VicGFja19yZXF1aXJlX18uZCA9IChleHBvcnRzLCBkZWZpbml0aW9uKSA9PiB7XG5cdGZvcih2YXIga2V5IGluIGRlZmluaXRpb24pIHtcblx0XHRpZihfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZGVmaW5pdGlvbiwga2V5KSAmJiAhX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIGtleSkpIHtcblx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBrZXksIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBkZWZpbml0aW9uW2tleV0gfSk7XG5cdFx0fVxuXHR9XG59OyIsIl9fd2VicGFja19yZXF1aXJlX18ubyA9IChvYmosIHByb3ApID0+IChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKSkiLCJleHBvcnQgZnVuY3Rpb24gb3BlblBvcHVwKGNsaWNrZWRQb3B1cCkge1xyXG4gIGNsaWNrZWRQb3B1cC5jbGFzc0xpc3QuYWRkKFwicG9wdXBfX29wZW5lZFwiKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNsb3NlUG9wdXAoY2xpY2tlZFBvcHVwKSB7XHJcbiAgY2xpY2tlZFBvcHVwLmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9fb3BlbmVkXCIpO1xyXG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGVzY0hhbmRsZXIpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZXNjSGFuZGxlcihldnQpIHtcclxuICBpZiAoZXZ0LmtleSA9PT0gXCJFc2NhcGVcIikge1xyXG4gICAgY29uc3Qgb3BlbmVkUG9wdXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX19vcGVuZWRcIik7XHJcbiAgICBjbG9zZVBvcHVwKG9wZW5lZFBvcHVwKTtcclxuICB9XHJcbn1cclxuIiwiZXhwb3J0IGNvbnN0IGRhdGEgPSB7XHJcbiAgYmFzZVVybDogXCJodHRwczovL25vbW9yZXBhcnRpZXMuY28vdjEvcGx1cy1jb2hvcnQtMThcIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcImFiZTFkN2FlLWVjYzktNDdkNS1hMzVmLTc0NTM2NTk5NDI2ZVwiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgfSxcclxufTtcclxuXHJcbmZ1bmN0aW9uIGdldFJlc0RhdGEocmVzKSB7XHJcbiAgaWYgKHJlcy5vaykge1xyXG4gICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgfVxyXG4gIHJldHVybiBQcm9taXNlLnJlamVjdChyZXMuc3RhdHVzKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEluaXRpYWxDYXJkcygpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7ZGF0YS5iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgIG1ldGhvZDogXCJHRVRcIixcclxuICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVycyxcclxuICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgIHJldHVybiBnZXRSZXNEYXRhKHJlcyk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRVc2VySW5mb3JtYXRpb24oKSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2RhdGEuYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICBtZXRob2Q6IFwiR0VUXCIsXHJcbiAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnMsXHJcbiAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICByZXR1cm4gZ2V0UmVzRGF0YShyZXMpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZWRpdFByb2ZpbGVJbmZvKG5hbWUsIGFib3V0KSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2RhdGEuYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVycyxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgbmFtZTogYCR7bmFtZX1gLFxyXG4gICAgICBhYm91dDogYCR7YWJvdXR9YCxcclxuICAgIH0pLFxyXG4gIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgcmV0dXJuIGdldFJlc0RhdGEocmVzKTtcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHBvc3ROZXdDYXJkKG5hbWUsIGxpbmspIHtcclxuICByZXR1cm4gZmV0Y2goYCR7ZGF0YS5iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIG5hbWU6IGAke25hbWV9YCxcclxuICAgICAgbGluazogYCR7bGlua31gLFxyXG4gICAgfSksXHJcbiAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICByZXR1cm4gZ2V0UmVzRGF0YShyZXMpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlQ2FyZChjYXJkSWQpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7ZGF0YS5iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnMsXHJcbiAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICByZXR1cm4gZ2V0UmVzRGF0YShyZXMpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcG9zdEF2YXRhcihhdmF0YXJMaW5rKSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2RhdGEuYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGF2YXRhcjogYCR7YXZhdGFyTGlua31gLFxyXG4gICAgfSksXHJcbiAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICByZXR1cm4gZ2V0UmVzRGF0YShyZXMpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcHV0TGlrZShjYXJkSWQpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7ZGF0YS5iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnMsXHJcbiAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICByZXR1cm4gZ2V0UmVzRGF0YShyZXMpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlTGlrZShjYXJkSWQpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7ZGF0YS5iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnMsXHJcbiAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICByZXR1cm4gZ2V0UmVzRGF0YShyZXMpO1xyXG4gIH0pO1xyXG59XHJcbiIsImV4cG9ydCBmdW5jdGlvbiBzd2l0Y2hMb2FkaW5nTWVzZyhEZXN0aW5hdGlvbiwgTG9hZGluZykge1xyXG4gIGlmIChMb2FkaW5nKSB7XHJcbiAgICBEZXN0aW5hdGlvbi50ZXh0Q29udGVudCA9IFwi0KHQvtGF0YDQsNC90LXQvdC40LUuLi5cIjtcclxuICB9IGVsc2Uge1xyXG4gICAgaWYgKERlc3RpbmF0aW9uLmlkKSB7XHJcbiAgICAgIERlc3RpbmF0aW9uLnRleHRDb250ZW50ID0gXCLQodC+0LfQtNCw0YLRjFwiO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgRGVzdGluYXRpb24udGV4dENvbnRlbnQgPSBcItCh0L7RhdGA0LDQvdC40YLRjFwiO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVVzZXJJbmZvcm1hdGlvbihhdmF0YXIsIG5hbWUsIGFib3V0LCBqc29uKSB7XHJcbiAgbmFtZS50ZXh0Q29udGVudCA9IGpzb25bXCJuYW1lXCJdO1xyXG4gIGFib3V0LnRleHRDb250ZW50ID0ganNvbltcImFib3V0XCJdO1xyXG4gIGF2YXRhci5zcmMgPSBqc29uW1wiYXZhdGFyXCJdO1xyXG59XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuaW1wb3J0IHsgb3BlblBvcHVwLCBjbG9zZVBvcHVwIH0gZnJvbSBcIi4vbW9kYWwuanNcIjtcclxuaW1wb3J0IHsgZGVsZXRlQ2FyZCwgcHV0TGlrZSwgZGVsZXRlTGlrZSwgcG9zdE5ld0NhcmQgfSBmcm9tIFwiLi9hcGkuanNcIjtcclxuaW1wb3J0IHsgc3dpdGNoTG9hZGluZ01lc2cgfSBmcm9tIFwiLi91dGlscy5qc1wiO1xyXG5pbXBvcnQgeyBlbGVtZW50cyB9IGZyb20gXCIuLy4uL2luZGV4LmpzXCI7XHJcbmV4cG9ydCBjb25zdCBwb3B1cEltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XHJcbmV4cG9ydCBjb25zdCBwb3B1cEFkZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfY2FyZC1hZGRcIik7XHJcbmNvbnN0IHBvcHVwWm9vbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfaW1hZ2Utem9vbVwiKTtcclxuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpLmNvbnRlbnQ7XHJcbmNvbnN0IHBvcHVwQ2FwdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2NhcHRpb25cIik7XHJcbmNvbnN0IGZvcm1FbGVtZW50QWRkID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwb3B1cFByb2ZpbGVBZGRCdXR0b25cIik7XHJcbmNvbnN0IGRlc2NyaXB0aW9uQWRkRm9ybSA9IHBvcHVwQWRkLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgXCIucG9wdXBfX2Zvcm0tZmllbGRbbmFtZT1wbGFjZU5hbWUtaW5wdXRdXCJcclxuKTtcclxuY29uc3QgbGlua0FkZEZvcm0gPSBwb3B1cEFkZC5xdWVyeVNlbGVjdG9yKFxyXG4gIFwiLnBvcHVwX19mb3JtLWZpZWxkW25hbWU9cGxhY2VVcmwtaW5wdXRdXCJcclxuKTtcclxuZXhwb3J0IGZ1bmN0aW9uIHJlbmRlckluaXRpYWxDYXJkcyhjb250YWluZXIsIGpzb24sIG15SWQpIHtcclxuICBjb25zdCBzZWVuSWRzID0gbmV3IFNldCgpO1xyXG4gIGpzb24uZm9yRWFjaCgoY2FyZCkgPT4ge1xyXG4gICAgaWYgKCFzZWVuSWRzLmhhcyhjYXJkW1wiX2lkXCJdKSkge1xyXG4gICAgICBzZWVuSWRzLmFkZChjYXJkW1wiX2lkXCJdKTtcclxuICAgICAgY29udGFpbmVyLnByZXBlbmQoXHJcbiAgICAgICAgYWRkQ2FyZChcclxuICAgICAgICAgIGNhcmQubmFtZSxcclxuICAgICAgICAgIGNhcmQubGluayxcclxuICAgICAgICAgIGNhcmRbXCJvd25lclwiXVtcIl9pZFwiXSxcclxuICAgICAgICAgIG15SWQsXHJcbiAgICAgICAgICBjYXJkW1wibGlrZXNcIl0sXHJcbiAgICAgICAgICBjYXJkW1wiX2lkXCJdXHJcbiAgICAgICAgKVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBoYXNNeUxpa2UobXlJZCwgbGlrZXMpIHtcclxuICBjb25zdCBtYXRjaGluZ0xpa2VzID0gbGlrZXMuZmlsdGVyKChvYmopID0+IHtcclxuICAgIHJldHVybiBvYmpbXCJfaWRcIl0gPT0gbXlJZDtcclxuICB9KTtcclxuICByZXR1cm4gbWF0Y2hpbmdMaWtlcy5sZW5ndGggPT09IDE7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhZGRDYXJkKG5hbWUsIGxpbmssIE9XTkVSSUQsIG15SWQsIGxpa2VzLCBjYXJkSWQpIHtcclxuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRcIikuY2xvbmVOb2RlKHRydWUpO1xyXG4gIGNvbnN0IGxpa2VCdXR0b24gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2xpa2UtYnV0dG9uXCIpO1xyXG4gIGNvbnN0IGxpa2VzQ291bnRlciA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9fbGlrZS1jb3VudGVyXCIpO1xyXG4gIGxpa2VzQ291bnRlci50ZXh0Q29udGVudCA9IGxpa2VzLmxlbmd0aDtcclxuICBpZiAoaGFzTXlMaWtlKG15SWQsIGxpa2VzKSkge1xyXG4gICAgbGlrZUJ1dHRvbi5jbGFzc0xpc3QuYWRkKFwiZWxlbWVudF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gIH1cclxuICBsaWtlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XHJcbiAgICBpZiAoaGFzTXlMaWtlKG15SWQsIGxpa2VzKSkge1xyXG4gICAgICBkZWxldGVMaWtlKGNhcmRJZClcclxuICAgICAgICAudGhlbigodXBkYXRlZENhcmQpID0+IHtcclxuICAgICAgICAgIGxpa2VzQ291bnRlci50ZXh0Q29udGVudCA9IHVwZGF0ZWRDYXJkW1wibGlrZXNcIl0ubGVuZ3RoO1xyXG4gICAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKFwiZWxlbWVudF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xyXG4gICAgICAgICAgbGlrZXMgPSB1cGRhdGVkQ2FyZFtcImxpa2VzXCJdO1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coYNCn0YLQvi3RgtC+INC/0L7RiNC70L4g0L3QtSDRgtCw0LouINCe0YjQsdC40LrQsDogJHtlcnJvcn1gKTtcclxuICAgICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHB1dExpa2UoY2FyZElkKVxyXG4gICAgICAgIC50aGVuKCh1cGRhdGVkQ2FyZCkgPT4ge1xyXG4gICAgICAgICAgbGlrZXNDb3VudGVyLnRleHRDb250ZW50ID0gdXBkYXRlZENhcmRbXCJsaWtlc1wiXS5sZW5ndGg7XHJcbiAgICAgICAgICBldnQudGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoXCJlbGVtZW50X19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XHJcbiAgICAgICAgICBsaWtlcyA9IHVwZGF0ZWRDYXJkW1wibGlrZXNcIl07XHJcbiAgICAgICAgfSlcclxuICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhg0KfRgtC+LdGC0L4g0L/QvtGI0LvQviDQvdC1INGC0LDQui4g0J7RiNCx0LjQutCwOiAke2Vycm9yfWApO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBjb25zdCBkZWxldGVCdG4gPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2RlbGV0ZS1idXR0b25cIik7XHJcbiAgaWYgKG15SWQgPT0gT1dORVJJRCkge1xyXG4gICAgZGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIGNvbnN0IG5ld0NhcmQgPSBkZWxldGVCdG4uY2xvc2VzdChcIi5lbGVtZW50XCIpO1xyXG4gICAgICBkZWxldGVDYXJkKGNhcmRJZClcclxuICAgICAgICAudGhlbigoKSA9PiBuZXdDYXJkLnJlbW92ZSgpKVxyXG4gICAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhg0KfRgtC+LdGC0L4g0L/QvtGI0LvQviDQvdC1INGC0LDQui4g0J7RiNCx0LjQutCwOiAke2Vycn1gKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBkZWxldGVCdG4ucmVtb3ZlKCk7XHJcbiAgfVxyXG5cclxuICBjb25zdCBpbWFnZSA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9faW1hZ2VcIik7XHJcbiAgaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgIG9wZW5Qb3B1cChwb3B1cFpvb20pO1xyXG4gICAgcG9wdXBJbWFnZS5zcmMgPSBsaW5rO1xyXG4gICAgcG9wdXBJbWFnZS5hbHQgPSBg0KTQvtGC0L4gJHtuYW1lfWA7XHJcbiAgICBwb3B1cENhcHRpb24udGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gIH0pO1xyXG5cclxuICBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2luZm9cIikudGV4dENvbnRlbnQgPSBuYW1lO1xyXG4gIGltYWdlLnNyYyA9IGxpbms7XHJcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKFwiYWx0XCIsIGDQpNC+0YLQviAke25hbWV9YCk7XHJcbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xyXG59XHJcbmZvcm1FbGVtZW50QWRkLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZnVuY3Rpb24gKGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIHN3aXRjaExvYWRpbmdNZXNnKGV2dC5zdWJtaXR0ZXIsIHRydWUpO1xyXG4gIHBvc3ROZXdDYXJkKGRlc2NyaXB0aW9uQWRkRm9ybS52YWx1ZSwgbGlua0FkZEZvcm0udmFsdWUpXHJcbiAgICAudGhlbigoanNvbikgPT4ge1xyXG4gICAgICBlbGVtZW50cy5wcmVwZW5kKFxyXG4gICAgICAgIGFkZENhcmQoXHJcbiAgICAgICAgICBqc29uW1wibmFtZVwiXSxcclxuICAgICAgICAgIGpzb25bXCJsaW5rXCJdLFxyXG4gICAgICAgICAganNvbltcIm93bmVyXCJdW1wiX2lkXCJdLFxyXG4gICAgICAgICAganNvbltcIm93bmVyXCJdW1wiX2lkXCJdLFxyXG4gICAgICAgICAganNvbltcImxpa2VzXCJdLFxyXG4gICAgICAgICAganNvbltcIl9pZFwiXVxyXG4gICAgICAgIClcclxuICAgICAgKTtcclxuICAgICAgY2xvc2VQb3B1cChwb3B1cEFkZCk7XHJcbiAgICAgIGZvcm1FbGVtZW50QWRkLnJlc2V0KCk7XHJcbiAgICB9KVxyXG4gICAgLmNhdGNoKChlcnIpID0+IHtcclxuICAgICAgY29uc29sZS5sb2coYNCn0YLQvi3RgtC+INC/0L7RiNC70L4g0L3QtSDRgtCw0LouINCe0YjQsdC40LrQsDogJHtlcnJ9YCk7XHJcbiAgICB9KVxyXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBzd2l0Y2hMb2FkaW5nTWVzZyhldnQuc3VibWl0dGVyLCBmYWxzZSk7XHJcbiAgICAgIH0sIDMwMCk7XHJcbiAgICB9KTtcclxufSk7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5cclxuaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcclxuaW1wb3J0IHsgb3BlblBvcHVwLCBjbG9zZVBvcHVwLCBlc2NIYW5kbGVyIH0gZnJvbSBcIi4vY29tcG9uZW50cy9tb2RhbC5qc1wiO1xyXG5pbXBvcnQge1xyXG4gIGdldEluaXRpYWxDYXJkcyxcclxuICBnZXRVc2VySW5mb3JtYXRpb24sXHJcbiAgZWRpdFByb2ZpbGVJbmZvLFxyXG4gIHBvc3RBdmF0YXIsXHJcbn0gZnJvbSBcIi4vY29tcG9uZW50cy9hcGkuanNcIjtcclxuaW1wb3J0IHtcclxuICB1cGRhdGVVc2VySW5mb3JtYXRpb24sXHJcbiAgc3dpdGNoTG9hZGluZ01lc2csXHJcbn0gZnJvbSBcIi4vY29tcG9uZW50cy91dGlscy5qc1wiO1xyXG5pbXBvcnQgeyByZW5kZXJJbml0aWFsQ2FyZHMsIHBvcHVwSW1hZ2UsIHBvcHVwQWRkIH0gZnJvbSBcIi4vY29tcG9uZW50cy9jYXJkLmpzXCI7XHJcbmltcG9ydCB7IGVuYWJsZVZhbGlkYXRpb24gfSBmcm9tIFwiLi9jb21wb25lbnRzL3ZhbGlkYXRlLmpzXCI7XHJcbmV4cG9ydCBjb25zdCBlbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudHNcIik7XHJcbmNvbnN0IHByb2ZpbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVcIik7XHJcbmNvbnN0IHByb2ZpbGVFZGl0QnV0dG9uID0gcHJvZmlsZS5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2VkaXQtYnV0dG9uXCIpO1xyXG5jb25zdCBwb3B1cEVkaXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX3Byb2ZpbGUtZWRpdFwiKTtcclxuY29uc3QgcG9wdXBDaGFuZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1jaGFuZ2VcIik7XHJcbmNvbnN0IHBvcHVwQ2hhbmdlRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfZm9ybV9sYXlvdXRcIik7XHJcbmNvbnN0IGFsbFBvcHVwID0gQXJyYXkuZnJvbShkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBvcHVwXCIpKTtcclxuY29uc3QgcHJvZmlsZUFkZEJ1dHRvbiA9IHByb2ZpbGUucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnV0dG9uXCIpO1xyXG5jb25zdCBmb3JtRWxlbWVudEVkaXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BvcHVwUHJvZmlsZUVkaXRGb3JtXCIpO1xyXG5jb25zdCBuYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGVfX25hbWUtaW5wdXRcIik7XHJcbmNvbnN0IGpvYklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlX19kZXNjcmlwdGlvbi1pbnB1dFwiKTtcclxuY29uc3QgaW5wdXROYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlX19uYW1lXCIpO1xyXG5jb25zdCBpbnB1dERlc2NyaXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlX19kZXNjcmlwdGlvblwiKTtcclxuY29uc3QgcGxhY2VOYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BsYWNlTmFtZS1pbnB1dFwiKTtcclxuY29uc3QgcGxhY2VVcmxJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcGxhY2VVcmwtaW5wdXRcIik7XHJcbmNvbnN0IGF2YXRhckNoYW5nZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXHJcbiAgXCIucHJvZmlsZV9fYXZhdGFyLWNoYW5nZS1idXR0b25cIlxyXG4pO1xyXG5jb25zdCBhdmF0YXJJbWFnZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fYXZhdGFyXCIpO1xyXG5jb25zdCBwb3B1cEF2YXRhckNoYW5nZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLWNoYW5nZVwiKTtcclxuY29uc3QgYXZhdGFyQ2hhbmdlSW5wdXQgPSBwb3B1cENoYW5nZUZvcm0ucXVlcnlTZWxlY3RvcihcclxuICBcIi5wb3B1cF9fZm9ybS1maWVsZFtuYW1lPXBsYWNlQXZhdGFyLWNoYW5nZS1pbnB1dF1cIlxyXG4pO1xyXG5cclxuY29uc3QgYWRkQ2FyZFN1Ym1pdEJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYWRkQ2FyZFN1Ym1pdEJ0blwiKTtcclxuY29uc3QgY2xvc2VCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cF9fY2xvc2UtYnV0dG9uXCIpO1xyXG5cclxuZ2V0VXNlckluZm9ybWF0aW9uKCkudGhlbigoZGF0YSkgPT4ge1xyXG4gIHVwZGF0ZVVzZXJJbmZvcm1hdGlvbihwb3B1cEltYWdlLCBpbnB1dE5hbWUsIGlucHV0RGVzY3JpcHRpb24sIGRhdGEpO1xyXG4gIGNvbnN0IG15SWQgPSBkYXRhW1wiX2lkXCJdO1xyXG4gIGdldEluaXRpYWxDYXJkcygpXHJcbiAgICAudGhlbigoanNvbikgPT4ge1xyXG4gICAgICByZW5kZXJJbml0aWFsQ2FyZHMoZWxlbWVudHMsIGpzb24sIG15SWQpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGDQp9GC0L4t0YLQviDQv9C+0YjQu9C+INC90LUg0YLQsNC6LiDQntGI0LHQuNC60LA6ICR7ZXJyfWApO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5jbG9zZUJ1dHRvbnMuZm9yRWFjaCgoYnV0dG9uKSA9PiB7XHJcbiAgY29uc3QgcG9wdXAgPSBidXR0b24uY2xvc2VzdChcIi5wb3B1cFwiKTtcclxuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlUG9wdXAocG9wdXApKTtcclxufSk7XHJcblxyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5dXBcIiwgZXNjSGFuZGxlcik7XHJcbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgb3BlblBvcHVwKHBvcHVwRWRpdCk7XHJcbn0pO1xyXG5hbGxQb3B1cC5mb3JFYWNoKChwb3B1cCkgPT4ge1xyXG4gIGFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24gKGV2dCkge1xyXG4gICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfX29wZW5lZFwiKSkge1xyXG4gICAgICBjbG9zZVBvcHVwKHBvcHVwKTtcclxuICAgIH1cclxuICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX19jbG9zZS1idXR0b25cIikpIHtcclxuICAgICAgY2xvc2VQb3B1cChwb3B1cCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn0pO1xyXG5wcm9maWxlRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gIG9wZW5Qb3B1cChwb3B1cEVkaXQpO1xyXG4gIG5hbWVJbnB1dC52YWx1ZSA9IGlucHV0TmFtZS5pbm5lclRleHQ7XHJcbiAgam9iSW5wdXQudmFsdWUgPSBpbnB1dERlc2NyaXB0aW9uLmlubmVyVGV4dDtcclxufSk7XHJcbnBvcHVwUHJvZmlsZUVkaXRGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZnVuY3Rpb24gKGV2dCkge1xyXG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIHN3aXRjaExvYWRpbmdNZXNnKGV2dC5zdWJtaXR0ZXIsIHRydWUpO1xyXG4gIGVkaXRQcm9maWxlSW5mbyhuYW1lSW5wdXQudmFsdWUsIGpvYklucHV0LnZhbHVlKVxyXG4gICAgLnRoZW4oKGpzb24pID0+IHtcclxuICAgICAgdXBkYXRlVXNlckluZm9ybWF0aW9uKHBvcHVwSW1hZ2UsIGlucHV0TmFtZSwgaW5wdXREZXNjcmlwdGlvbiwganNvbik7XHJcbiAgICAgIGNsb3NlUG9wdXAocG9wdXBFZGl0KTtcclxuICAgIH0pXHJcbiAgICAuY2F0Y2goKGVycikgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZyhg0KfRgtC+LdGC0L4g0L/QvtGI0LvQviDQvdC1INGC0LDQui4g0J7RiNCx0LjQutCwOiAke2Vycn1gKTtcclxuICAgIH0pXHJcbiAgICAuZmluYWxseSgoKSA9PiB7XHJcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHN3aXRjaExvYWRpbmdNZXNnKGV2dC5zdWJtaXR0ZXIsIGZhbHNlKTtcclxuICAgICAgfSwgMzAwKTtcclxuICAgIH0pO1xyXG59KTtcclxucHJvZmlsZUFkZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xyXG4gIG9wZW5Qb3B1cChwb3B1cEFkZCk7XHJcbn0pO1xyXG5hdmF0YXJDaGFuZ2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcclxuICBvcGVuUG9wdXAocG9wdXBDaGFuZ2UpO1xyXG59KTtcclxucG9wdXBBdmF0YXJDaGFuZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XHJcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgc3dpdGNoTG9hZGluZ01lc2coZXZ0LnN1Ym1pdHRlciwgdHJ1ZSk7XHJcbiAgcG9zdEF2YXRhcihhdmF0YXJDaGFuZ2VJbnB1dC52YWx1ZSlcclxuICAgIC50aGVuKChqc29uKSA9PiB7XHJcbiAgICAgIHVwZGF0ZVVzZXJJbmZvcm1hdGlvbihwb3B1cEltYWdlLCBpbnB1dE5hbWUsIGlucHV0RGVzY3JpcHRpb24sIGpzb24pO1xyXG4gICAgICBjbG9zZVBvcHVwKHBvcHVwQ2hhbmdlKTtcclxuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xyXG4gICAgfSlcclxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGDQp9GC0L4t0YLQviDQv9C+0YjQu9C+INC90LUg0YLQsNC6LiDQntGI0LHQuNC60LA6ICR7ZXJyfWApO1xyXG4gICAgfSlcclxuICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgc3dpdGNoTG9hZGluZ01lc2coZXZ0LnN1Ym1pdHRlciwgZmFsc2UpO1xyXG4gICAgICB9LCAzMDApO1xyXG4gICAgfSk7XHJcbn0pO1xyXG5cclxuY29uc3QgZW5hYmxlVmFsaWRhdGlvbkNvbnN0YW50cyA9IHtcclxuICBmb3JtU2VsZWN0b3I6IFwiLnBvcHVwX19mb3JtXCIsXHJcbiAgaW5wdXRTZWxlY3RvcjogXCIucG9wdXBfX2Zvcm0tZmllbGRcIixcclxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIucG9wdXBfX2J1dHRvblwiLFxyXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwicG9wdXBfX2J1dHRvbl9ub3RBY3RpdmVcIixcclxuICBpbnB1dEVycm9yQ2xhc3M6IFwicG9wdXBfX2Vyb3ItbWFzYWdlXCIsXHJcbiAgZXJyb3JDbGFzczogXCJwb3B1cF9fZXJvci1tYXNhZ2VfYWN0aXZlXCIsXHJcbn07XHJcbmVuYWJsZVZhbGlkYXRpb24oZW5hYmxlVmFsaWRhdGlvbkNvbnN0YW50cyk7XHJcbiIsImZ1bmN0aW9uIHNob3dJbnB1dEVycm9yKGZvcm0sIGlucHV0LCBlcnJvck1lc3NhZ2UpIHtcclxuICBjb25zdCBlcnJvciA9IGZvcm0ucXVlcnlTZWxlY3RvcihgLiR7aW5wdXQuaWR9LWVycm9yYCk7XHJcbiAgZXJyb3IuY2xhc3NMaXN0LmFkZChcInBvcHVwX19lcm9yLW1hc2FnZVwiKTtcclxuICBpZiAoaW5wdXQudmFsdWUgPT09IFwiXCIpIHtcclxuICAgIGVycm9yLnRleHRDb250ZW50ID0gXCLQktGLINC/0YDQvtC/0YPRgdGC0LjQu9C4INGN0YLQviDQv9C+0LvQtVwiO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBlcnJvci50ZXh0Q29udGVudCA9IGVycm9yTWVzc2FnZTtcclxuICB9XHJcbiAgZXJyb3IuY2xhc3NMaXN0LmFkZChcInBvcHVwX19lcm9yLW1hc2FnZV9hY3RpdmVcIik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhpZGVJbnB1dEVycm9yKGZvcm0sIGlucHV0KSB7XHJcbiAgY29uc3QgZXJyb3IgPSBmb3JtLnF1ZXJ5U2VsZWN0b3IoYC4ke2lucHV0LmlkfS1lcnJvcmApO1xyXG4gIGVycm9yLmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9fZXJvci1tYXNhZ2VcIik7XHJcbiAgZXJyb3IudGV4dENvbnRlbnQgPSBcIlwiO1xyXG4gIGVycm9yLmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9fZXJvci1tYXNhZ2VfYWN0aXZlXCIpO1xyXG4gIGlucHV0LmNsYXNzTGlzdC5yZW1vdmUoXCJwb3B1cF9fZm9ybS1maWVsZF90eXBlX2Vycm9yXCIpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjaGVja0lucHV0VmFsaWRpdHkoZm9ybSwgaW5wdXQpIHtcclxuICBpZiAoIWlucHV0LnZhbGlkaXR5LnZhbGlkKSB7XHJcbiAgICBzaG93SW5wdXRFcnJvcihmb3JtLCBpbnB1dCwgaW5wdXQudmFsaWRhdGlvbk1lc3NhZ2UpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtLCBpbnB1dCk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYXNJbnZhbGlkSW5wdXQoaW5wdXRzKSB7XHJcbiAgcmV0dXJuIEFycmF5LnByb3RvdHlwZS5zb21lLmNhbGwoaW5wdXRzLCBmdW5jdGlvbiAoaW5wdXQpIHtcclxuICAgIHJldHVybiBpbnB1dC52YWxpZGl0eS52YWxpZCA9PT0gZmFsc2U7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRvZ2dsZVN1Ym1pdEJ1dHRvblN0YXRlKGZvcm0sIGJ1dHRvblNlbGVjdG9yLCBpbmFjdGl2ZUNsYXNzKSB7XHJcbiAgY29uc3QgYnV0dG9uID0gZm9ybS5xdWVyeVNlbGVjdG9yKGJ1dHRvblNlbGVjdG9yKTtcclxuICBpZiAoaGFzSW52YWxpZElucHV0KGZvcm0ucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cF9fZm9ybS1maWVsZFwiKSkpIHtcclxuICAgIGJ1dHRvbi5jbGFzc0xpc3QuYWRkKGluYWN0aXZlQ2xhc3MpO1xyXG4gICAgYnV0dG9uLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIHRydWUpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBidXR0b24uY2xhc3NMaXN0LnJlbW92ZShpbmFjdGl2ZUNsYXNzKTtcclxuICAgIGJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHNldEV2ZW50TGlzdGVuZXJzKGZvcm0sIGJ1dHRvblNlbGVjdG9yLCBpbmFjdGl2ZUNsYXNzKSB7XHJcbiAgY29uc3QgaW5wdXRzID0gQXJyYXkuZnJvbShmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBfX2Zvcm0tZmllbGRcIikpO1xyXG5cclxuICBpbnB1dHMuZm9yRWFjaCgoaW5wdXQpID0+IHtcclxuICAgIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XHJcbiAgICAgIHRvZ2dsZVN1Ym1pdEJ1dHRvblN0YXRlKGZvcm0sIGJ1dHRvblNlbGVjdG9yLCBpbmFjdGl2ZUNsYXNzKTtcclxuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm0sIGlucHV0KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2ZW50KSA9PiB7XHJcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZW5hYmxlVmFsaWRhdGlvbihlbmFibGVWYWxpZGF0aW9uQ29uc3RhbnRzKSB7XHJcbiAgY29uc3QgZm9ybXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFxyXG4gICAgZW5hYmxlVmFsaWRhdGlvbkNvbnN0YW50cy5mb3JtU2VsZWN0b3JcclxuICApO1xyXG5cclxuICBmb3Jtcy5mb3JFYWNoKChmb3JtKSA9PiB7XHJcbiAgICBmb3JtLnNldEF0dHJpYnV0ZShcIm5vdmFsaWRhdGVcIiwgdHJ1ZSk7XHJcbiAgICBzZXRFdmVudExpc3RlbmVycyhcclxuICAgICAgZm9ybSxcclxuICAgICAgZW5hYmxlVmFsaWRhdGlvbkNvbnN0YW50cy5zdWJtaXRCdXR0b25TZWxlY3RvcixcclxuICAgICAgZW5hYmxlVmFsaWRhdGlvbkNvbnN0YW50cy5pbmFjdGl2ZUJ1dHRvbkNsYXNzXHJcbiAgICApO1xyXG4gIH0pO1xyXG59XHJcbiJdLCJuYW1lcyI6WyJfX3dlYnBhY2tfcmVxdWlyZV9fIiwiZXhwb3J0cyIsImRlZmluaXRpb24iLCJrZXkiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0Iiwib2JqIiwicHJvcCIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsIm9wZW5Qb3B1cCIsImNsaWNrZWRQb3B1cCIsImNsYXNzTGlzdCIsImFkZCIsImNsb3NlUG9wdXAiLCJyZW1vdmUiLCJkb2N1bWVudCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJlc2NIYW5kbGVyIiwiZXZ0IiwicXVlcnlTZWxlY3RvciIsImRhdGEiLCJiYXNlVXJsIiwiaGVhZGVycyIsImF1dGhvcml6YXRpb24iLCJnZXRSZXNEYXRhIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldEluaXRpYWxDYXJkcyIsImZldGNoIiwibWV0aG9kIiwidGhlbiIsInN3aXRjaExvYWRpbmdNZXNnIiwiRGVzdGluYXRpb24iLCJMb2FkaW5nIiwidGV4dENvbnRlbnQiLCJpZCIsInVwZGF0ZVVzZXJJbmZvcm1hdGlvbiIsImF2YXRhciIsIm5hbWUiLCJhYm91dCIsInNyYyIsInBvcHVwSW1hZ2UiLCJwb3B1cEFkZCIsInBvcHVwWm9vbSIsImNhcmRUZW1wbGF0ZSIsImNvbnRlbnQiLCJwb3B1cENhcHRpb24iLCJmb3JtRWxlbWVudEFkZCIsImRlc2NyaXB0aW9uQWRkRm9ybSIsImxpbmtBZGRGb3JtIiwiaGFzTXlMaWtlIiwibXlJZCIsImxpa2VzIiwiZmlsdGVyIiwibGVuZ3RoIiwiYWRkQ2FyZCIsImxpbmsiLCJPV05FUklEIiwiY2FyZElkIiwiY2FyZEVsZW1lbnQiLCJjbG9uZU5vZGUiLCJsaWtlQnV0dG9uIiwibGlrZXNDb3VudGVyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImRlbGV0ZUxpa2UiLCJ1cGRhdGVkQ2FyZCIsInRhcmdldCIsInRvZ2dsZSIsImNhdGNoIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwicHV0TGlrZSIsImRlbGV0ZUJ0biIsIm5ld0NhcmQiLCJjbG9zZXN0IiwiZGVsZXRlQ2FyZCIsImVyciIsImltYWdlIiwiYWx0Iiwic2V0QXR0cmlidXRlIiwicHJldmVudERlZmF1bHQiLCJzdWJtaXR0ZXIiLCJ2YWx1ZSIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZWxlbWVudHMiLCJyZXNldCIsImZpbmFsbHkiLCJzZXRUaW1lb3V0IiwiZW5hYmxlVmFsaWRhdGlvbkNvbnN0YW50cyIsInByb2ZpbGUiLCJwcm9maWxlRWRpdEJ1dHRvbiIsInBvcHVwRWRpdCIsInBvcHVwQ2hhbmdlIiwicG9wdXBDaGFuZ2VGb3JtIiwiYWxsUG9wdXAiLCJBcnJheSIsImZyb20iLCJxdWVyeVNlbGVjdG9yQWxsIiwicHJvZmlsZUFkZEJ1dHRvbiIsIm5hbWVJbnB1dCIsImpvYklucHV0IiwiaW5wdXROYW1lIiwiaW5wdXREZXNjcmlwdGlvbiIsImF2YXRhckNoYW5nZUJ0biIsInBvcHVwQXZhdGFyQ2hhbmdlIiwiYXZhdGFyQ2hhbmdlSW5wdXQiLCJjbG9zZUJ1dHRvbnMiLCJjb250YWluZXIiLCJzZWVuSWRzIiwiU2V0IiwiZm9yRWFjaCIsImNhcmQiLCJoYXMiLCJwcmVwZW5kIiwicmVuZGVySW5pdGlhbENhcmRzIiwiYnV0dG9uIiwicG9wdXAiLCJjb250YWlucyIsImlubmVyVGV4dCIsInBvcHVwUHJvZmlsZUVkaXRGb3JtIiwiYXZhdGFyTGluayIsImZvcm1TZWxlY3RvciIsImlucHV0U2VsZWN0b3IiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImluYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbnB1dEVycm9yQ2xhc3MiLCJlcnJvckNsYXNzIiwiZm9ybSIsImJ1dHRvblNlbGVjdG9yIiwiaW5hY3RpdmVDbGFzcyIsImlucHV0IiwiaW5wdXRzIiwic29tZSIsInZhbGlkaXR5IiwidmFsaWQiLCJyZW1vdmVBdHRyaWJ1dGUiLCJ0b2dnbGVTdWJtaXRCdXR0b25TdGF0ZSIsImhpZGVJbnB1dEVycm9yIiwiZXJyb3JNZXNzYWdlIiwic2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImNoZWNrSW5wdXRWYWxpZGl0eSIsImV2ZW50Iiwic2V0RXZlbnRMaXN0ZW5lcnMiXSwic291cmNlUm9vdCI6IiJ9