(()=>{"use strict";var e=document.querySelector(".profile__avatar"),t=document.querySelector(".popup_card-add");function n(e){e.classList.add("popup__opened"),document.addEventListener("keydown",r)}function o(e){e.classList.remove("popup__opened"),document.removeEventListener("keydown",r)}function r(e){"Escape"===e.key&&o(document.querySelector(".popup__opened"))}var c={baseUrl:"https://nomoreparties.co/v1/plus-cohort-18",headers:{authorization:"abe1d7ae-ecc9-47d5-a35f-74536599426e","Content-Type":"application/json"}};function u(e){return e.ok?e.json():Promise.reject(e.status)}function a(){return fetch("".concat(c.baseUrl,"/cards"),{method:"GET",headers:c.headers}).then((function(e){return u(e)}))}function i(e,t){t?e.textContent="Сохранение...":e.id?e.textContent="Создать":e.textContent="Сохранить"}function l(e,t,n,o){t.textContent=o.name,n.textContent=o.about,e.src=o.avatar}var s=document.querySelector(".elements"),d=document.querySelector(".popup_image-zoom"),p=document.querySelector("#card-template").content,f=document.querySelector(".popup__caption"),m=document.querySelector(".popup__image"),_=document.querySelector("#popupProfileAddButton"),v=t.querySelector(".popup__form-field[name=placeName-input]"),h=t.querySelector(".popup__form-field[name=placeUrl-input]");function y(e,t){return 1===t.filter((function(t){return t._id==e})).length}function S(e,t,o,r,a,i){var l=p.querySelector(".element").cloneNode(!0),s=l.querySelector(".element__like-button"),_=l.querySelector(".element__like-counter");_.textContent=a.length,y(r,a)&&s.classList.add("element__like-button_active"),s.addEventListener("click",(function(e){y(r,a)?function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:c.headers}).then((function(e){return u(e)}))}(i).then((function(t){_.textContent=t.likes.length,e.target.classList.toggle("element__like-button_active"),a=t.likes})).catch((function(e){console.log("Что-то пошло не так. Ошбика: ".concat(e))})):function(e){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:c.headers}).then((function(e){return u(e)}))}(i).then((function(t){_.textContent=t.likes.length,e.target.classList.toggle("element__like-button_active"),a=t.likes})).catch((function(e){console.log("Что-то пошло не так. Ошбика: ".concat(e))}))}));var v=l.querySelector(".element__delete-button");r==o?v.addEventListener("click",(function(){var e=v.closest(".element");(function(e){return fetch("".concat(c.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:c.headers}).then((function(e){return u(e)}))})(i).then((function(){return e.remove()})).catch((function(e){console.log("Что-то пошло не так. Ошбика: ".concat(e))}))})):v.remove();var h=l.querySelector(".element__image");return h.addEventListener("click",(function(){n(d),m.src=t,m.alt="Фото ".concat(e),f.textContent=e})),l.querySelector(".element__info").textContent=e,h.src=t,h.setAttribute("alt","Фото ".concat(e)),l}_.addEventListener("submit",(function(e){var n,r;e.preventDefault(),i(e.submitter,!0),(n=v.value,r=h.value,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:"".concat(n),link:"".concat(r)})}).then((function(e){return u(e)}))).then((function(e){s.prepend(S(e.name,e.link,e.owner._id,e.owner._id,e.likes,e._id)),o(t),_.reset()})).catch((function(e){console.log("Что-то пошло не так. Ошбика: ".concat(e))})).finally((function(){setTimeout((function(){i(e.submitter,!1)}),300)}))}));var b=["formSelector"];function E(e,t){var n=t.submitButtonSelector,o=t.inactiveButtonClass,r=t.inputSelector,c=e.querySelectorAll(r),u=e.querySelectorAll(n);(function(e){return Array.prototype.some.call(e,(function(e){return!1===e.validity.valid}))})(c)||function(e){return Array.prototype.some.call(e,(function(e){return""===e.value}))}(c)?u.forEach((function(e){e.classList.add(o),e.setAttribute("disabled",!0)})):u.forEach((function(e){e.classList.remove(o),e.removeAttribute("disabled")}))}var q,g,C,L=document.querySelector(".profile"),k=L.querySelector(".profile__edit-button"),A=document.querySelector(".popup_profile-edit"),x=document.querySelector("#avatar-change"),T=document.querySelector(".popup_form_layout"),O=Array.from(document.querySelectorAll(".popup")),U=L.querySelector(".profile__add-button"),B=(document.querySelector("#popupProfileEditForm"),document.querySelector("#profile__name-input")),P=document.querySelector("#profile__description-input"),w=document.querySelector("#profile__name"),j=document.querySelector("#profile__description"),D=(document.querySelector("#placeName-input"),document.querySelector("#placeUrl-input"),document.querySelector(".profile__avatar-change-button")),N=(document.querySelector(".profile__avatar"),document.querySelector("#avatar-change")),J=T.querySelector(".popup__form-field[name=placeAvatar-change-input]"),z=(document.querySelector("#addCardSubmitBtn"),document.querySelectorAll(".popup__close-button"));fetch("".concat(c.baseUrl,"/users/me"),{method:"GET",headers:c.headers}).then((function(e){return u(e)})).then((function(t){l(e,w,j,t);var n=t._id;a().then((function(e){!function(e,t,n){var o=new Set;t.forEach((function(t){o.has(t._id)||(o.add(t._id),e.prepend(S(t.name,t.link,t.owner._id,n,t.likes,t._id)))}))}(s,e,n)})).catch((function(e){console.log("Что-то пошло не так. Ошбика: ".concat(e))}))})),z.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return o(t)}))})),k.addEventListener("click",(function(){n(A)})),O.forEach((function(e){addEventListener("mousedown",(function(t){t.target.classList.contains("popup__opened")&&o(e),t.target.classList.contains("popup__close-button")&&o(e)}))})),k.addEventListener("click",(function(){n(A),B.value=w.innerText,P.value=j.innerText})),popupProfileEditForm.addEventListener("submit",(function(t){var n,r;t.preventDefault(),i(t.submitter,!0),(n=B.value,r=P.value,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:"".concat(n),about:"".concat(r)})}).then((function(e){return u(e)}))).then((function(t){l(e,w,j,t),o(A)})).catch((function(e){console.log("Что-то пошло не так. Ошбика: ".concat(e))})).finally((function(){setTimeout((function(){i(t.submitter,!1)}),300)}))})),U.addEventListener("click",(function(){n(t)})),D.addEventListener("click",(function(){n(x)})),N.addEventListener("submit",(function(t){var n;t.preventDefault(),i(t.submitter,!0),(n=J.value,fetch("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:"".concat(n)})}).then((function(e){return u(e)}))).then((function(n){l(e,w,j,n),o(x),t.target.reset()})).catch((function(e){console.log("Что-то пошло не так. Ошбика: ".concat(e))})).finally((function(){setTimeout((function(){i(t.submitter,!1)}),300)}))})),g=(q={formSelector:".popup__form",inputSelector:".popup__form-field",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_notActive",inputErrorClass:"popup__eror-masage",errorClass:"popup__eror-masage_active"}).formSelector,C=function(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},c=Object.keys(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)n=c[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(q,b),document.querySelectorAll(g).forEach((function(e){e.setAttribute("novalidate",!0),function(e,t){var n=t.inputSelector,o=t.submitButtonSelector,r=t.inactiveButtonClass,c=t.errorClass,u=t.inputErrorClass;Array.from(e.querySelectorAll(n)).forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n){var o=n.inputErrorClass,r=n.errorClass;t.addEventListener("focus",(function(){t.setAttribute("data-touched",!0)})),t.getAttribute("data-touched")&&!t.validity.valid?function(e,t,n,o){var r=o.inputErrorClass,c=o.errorClass,u=e.querySelector(".".concat(t.id,"-error"));u.classList.add(r),t.classList.add("popup__form-field_type_error"),""===t.value?u.textContent="Вы пропустили это поле":u.textContent=n,u.classList.add(c)}(e,t,t.validationMessage,{inputErrorClass:o,errorClass:r}):function(e,t,n){var o=n.inputErrorClass,r=n.errorClass,c=e.querySelector(".".concat(t.id,"-error"));c.classList.remove(o),c.textContent="",c.classList.remove(r),t.classList.remove(o),t.classList.remove("popup__form-field_type_error")}(e,t,{inputErrorClass:o,errorClass:r})}(e,t,{errorClass:c,inputErrorClass:u}),E(e,{submitButtonSelector:o,inactiveButtonClass:r,inputSelector:n})}))})),e.addEventListener("submit",(function(e){e.preventDefault()}))}(e,C),E(e,C)}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WUFBYyx5QkFFcEJtQyxFQUFNbkMsWUFBYzhHLEVBRXRCM0UsRUFBTTlELFVBQVVDLElBQUlzSSxFQUN0QixDQWlCSUcsQ0FBZXRELEVBQU1XLEVBQU9BLEVBQU00QyxrQkFBbUIsQ0FDbkRMLGdCQUFBQSxFQUNBQyxXQUFBQSxJQWpCTixTQUF3Qm5ELEVBQU1XLEVBQU8sR0FBaUMsSUFBL0J1QyxFQUFlLEVBQWZBLGdCQUFpQkMsRUFBVSxFQUFWQSxXQUNoRHpFLEVBQVFzQixFQUFLeEYsY0FBYyxJQUFELE9BQUttRyxFQUFNbkUsR0FBRSxXQUU3Q2tDLEVBQU05RCxVQUFVSyxPQUFPaUksR0FDdkJ4RSxFQUFNbkMsWUFBYyxHQUNwQm1DLEVBQU05RCxVQUFVSyxPQUFPa0ksR0FDdkJ4QyxFQUFNL0YsVUFBVUssT0FBT2lJLEdBQ3ZCdkMsRUFBTS9GLFVBQVVLLE9BQU8sK0JBQ3pCLENBWUl1SSxDQUFleEQsRUFBTVcsRUFBTyxDQUFFdUMsZ0JBQUFBLEVBQWlCQyxXQUFBQSxHQUVuRCxDQTRDTU0sQ0FBbUJ6RCxFQUFNVyxFQUFPLENBQUV3QyxXQUFBQSxFQUFZRCxnQkFBQUEsSUFDOUNuRCxFQUF3QkMsRUFBTSxDQUM1QkMscUJBQUFBLEVBQ0FDLG9CQUFBQSxFQUNBQyxjQUFBQSxHQUVKLEdBQ0YsSUFDQUgsRUFBS2xGLGlCQUFpQixVQUFVLFNBQUM0SSxHQUMvQkEsRUFBTXBFLGdCQUNSLEdBQ0YsQ0FRSXFFLENBQWtCM0QsRUFBTXFCLEdBQ3hCdEIsRUFBd0JDLEVBQU1xQixFQUNoQyxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8veWFuZGV4LnByYWt0aWt1bS8uL3NyYy9jb21wb25lbnRzL21vZGFsLmpzIiwid2VicGFjazovL3lhbmRleC5wcmFrdGlrdW0vLi9zcmMvY29tcG9uZW50cy9hcGkuanMiLCJ3ZWJwYWNrOi8veWFuZGV4LnByYWt0aWt1bS8uL3NyYy9jb21wb25lbnRzL3V0aWxzLmpzIiwid2VicGFjazovL3lhbmRleC5wcmFrdGlrdW0vLi9zcmMvY29tcG9uZW50cy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8veWFuZGV4LnByYWt0aWt1bS8uL3NyYy9jb21wb25lbnRzL2NhcmQuanMiLCJ3ZWJwYWNrOi8veWFuZGV4LnByYWt0aWt1bS8uL3NyYy9jb21wb25lbnRzL3ZhbGlkYXRlLmpzIiwid2VicGFjazovL3lhbmRleC5wcmFrdGlrdW0vLi9zcmMvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IHBvcHVwSW1hZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcbmV4cG9ydCBjb25zdCBwb3B1cEFkZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfY2FyZC1hZGRcIik7XG5cbmV4cG9ydCBmdW5jdGlvbiBvcGVuUG9wdXAoY2xpY2tlZFBvcHVwKSB7XG4gIGNsaWNrZWRQb3B1cC5jbGFzc0xpc3QuYWRkKFwicG9wdXBfX29wZW5lZFwiKTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZXNjSGFuZGxlcik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjbG9zZVBvcHVwKGNsaWNrZWRQb3B1cCkge1xuICBjbGlja2VkUG9wdXAuY2xhc3NMaXN0LnJlbW92ZShcInBvcHVwX19vcGVuZWRcIik7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGVzY0hhbmRsZXIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZXNjSGFuZGxlcihldnQpIHtcbiAgaWYgKGV2dC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICBjb25zdCBvcGVuZWRQb3B1cCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX29wZW5lZFwiKTtcbiAgICBjbG9zZVBvcHVwKG9wZW5lZFBvcHVwKTtcbiAgfVxufVxuIiwiZXhwb3J0IGNvbnN0IGRhdGEgPSB7XHJcbiAgYmFzZVVybDogXCJodHRwczovL25vbW9yZXBhcnRpZXMuY28vdjEvcGx1cy1jb2hvcnQtMThcIixcclxuICBoZWFkZXJzOiB7XHJcbiAgICBhdXRob3JpemF0aW9uOiBcImFiZTFkN2FlLWVjYzktNDdkNS1hMzVmLTc0NTM2NTk5NDI2ZVwiLFxyXG4gICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgfSxcclxufTtcclxuXHJcbmZ1bmN0aW9uIGdldFJlc0RhdGEocmVzKSB7XHJcbiAgaWYgKHJlcy5vaykge1xyXG4gICAgcmV0dXJuIHJlcy5qc29uKCk7XHJcbiAgfVxyXG4gIHJldHVybiBQcm9taXNlLnJlamVjdChyZXMuc3RhdHVzKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldEluaXRpYWxDYXJkcygpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7ZGF0YS5iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgIG1ldGhvZDogXCJHRVRcIixcclxuICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVycyxcclxuICB9KS50aGVuKChyZXMpID0+IHtcclxuICAgIHJldHVybiBnZXRSZXNEYXRhKHJlcyk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRVc2VySW5mb3JtYXRpb24oKSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2RhdGEuYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICBtZXRob2Q6IFwiR0VUXCIsXHJcbiAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnMsXHJcbiAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICByZXR1cm4gZ2V0UmVzRGF0YShyZXMpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZWRpdFByb2ZpbGVJbmZvKG5hbWUsIGFib3V0KSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2RhdGEuYmFzZVVybH0vdXNlcnMvbWVgLCB7XHJcbiAgICBtZXRob2Q6IFwiUEFUQ0hcIixcclxuICAgIGhlYWRlcnM6IGRhdGEuaGVhZGVycyxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgbmFtZTogYCR7bmFtZX1gLFxyXG4gICAgICBhYm91dDogYCR7YWJvdXR9YCxcclxuICAgIH0pLFxyXG4gIH0pLnRoZW4oKHJlcykgPT4ge1xyXG4gICAgcmV0dXJuIGdldFJlc0RhdGEocmVzKTtcclxuICB9KTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHBvc3ROZXdDYXJkKG5hbWUsIGxpbmspIHtcclxuICByZXR1cm4gZmV0Y2goYCR7ZGF0YS5iYXNlVXJsfS9jYXJkc2AsIHtcclxuICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIG5hbWU6IGAke25hbWV9YCxcclxuICAgICAgbGluazogYCR7bGlua31gLFxyXG4gICAgfSksXHJcbiAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICByZXR1cm4gZ2V0UmVzRGF0YShyZXMpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlQ2FyZChjYXJkSWQpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7ZGF0YS5iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnMsXHJcbiAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICByZXR1cm4gZ2V0UmVzRGF0YShyZXMpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcG9zdEF2YXRhcihhdmF0YXJMaW5rKSB7XHJcbiAgcmV0dXJuIGZldGNoKGAke2RhdGEuYmFzZVVybH0vdXNlcnMvbWUvYXZhdGFyYCwge1xyXG4gICAgbWV0aG9kOiBcIlBBVENIXCIsXHJcbiAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnMsXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGF2YXRhcjogYCR7YXZhdGFyTGlua31gLFxyXG4gICAgfSksXHJcbiAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICByZXR1cm4gZ2V0UmVzRGF0YShyZXMpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gcHV0TGlrZShjYXJkSWQpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7ZGF0YS5iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6IFwiUFVUXCIsXHJcbiAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnMsXHJcbiAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICByZXR1cm4gZ2V0UmVzRGF0YShyZXMpO1xyXG4gIH0pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlTGlrZShjYXJkSWQpIHtcclxuICByZXR1cm4gZmV0Y2goYCR7ZGF0YS5iYXNlVXJsfS9jYXJkcy9saWtlcy8ke2NhcmRJZH1gLCB7XHJcbiAgICBtZXRob2Q6IFwiREVMRVRFXCIsXHJcbiAgICBoZWFkZXJzOiBkYXRhLmhlYWRlcnMsXHJcbiAgfSkudGhlbigocmVzKSA9PiB7XHJcbiAgICByZXR1cm4gZ2V0UmVzRGF0YShyZXMpO1xyXG4gIH0pO1xyXG59XHJcbiIsImV4cG9ydCBmdW5jdGlvbiBzd2l0Y2hMb2FkaW5nTWVzZyhEZXN0aW5hdGlvbiwgTG9hZGluZykge1xyXG4gIGlmIChMb2FkaW5nKSB7XHJcbiAgICBEZXN0aW5hdGlvbi50ZXh0Q29udGVudCA9IFwi0KHQvtGF0YDQsNC90LXQvdC40LUuLi5cIjtcclxuICB9IGVsc2Uge1xyXG4gICAgaWYgKERlc3RpbmF0aW9uLmlkKSB7XHJcbiAgICAgIERlc3RpbmF0aW9uLnRleHRDb250ZW50ID0gXCLQodC+0LfQtNCw0YLRjFwiO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgRGVzdGluYXRpb24udGV4dENvbnRlbnQgPSBcItCh0L7RhdGA0LDQvdC40YLRjFwiO1xyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZVVzZXJJbmZvcm1hdGlvbihhdmF0YXIsIG5hbWUsIGFib3V0LCBqc29uKSB7XHJcbiAgbmFtZS50ZXh0Q29udGVudCA9IGpzb25bXCJuYW1lXCJdO1xyXG4gIGFib3V0LnRleHRDb250ZW50ID0ganNvbltcImFib3V0XCJdO1xyXG4gIGF2YXRhci5zcmMgPSBqc29uW1wiYXZhdGFyXCJdO1xyXG59XHJcbiIsImV4cG9ydCBjb25zdCBlbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudHNcIik7XG4vLyBleHBvcnQgY29uc3QgZW5hYmxlVmFsaWRhdGlvbkNvbnN0YW50cyA9IHtcbi8vICAgZm9ybVNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybVwiLFxuLy8gICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybS1maWVsZFwiLFxuLy8gICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIucG9wdXBfX2J1dHRvblwiLFxuLy8gICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcInBvcHVwX19idXR0b25fbm90QWN0aXZlXCIsXG4vLyAgIGlucHV0RXJyb3JDbGFzczogXCJwb3B1cF9fZXJvci1tYXNhZ2VcIixcbi8vICAgZXJyb3JDbGFzczogXCJwb3B1cF9fZXJvci1tYXNhZ2VfYWN0aXZlXCIsXG4vLyB9O1xuIiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IG9wZW5Qb3B1cCwgY2xvc2VQb3B1cCwgcG9wdXBJbWFnZSwgcG9wdXBBZGQgfSBmcm9tIFwiLi9tb2RhbC5qc1wiO1xuaW1wb3J0IHsgZGVsZXRlQ2FyZCwgcHV0TGlrZSwgZGVsZXRlTGlrZSwgcG9zdE5ld0NhcmQgfSBmcm9tIFwiLi9hcGkuanNcIjtcbmltcG9ydCB7IHN3aXRjaExvYWRpbmdNZXNnIH0gZnJvbSBcIi4vdXRpbHMuanNcIjtcbmltcG9ydCB7IGVsZW1lbnRzIH0gZnJvbSBcIi4vY29uc3RhbnRzLmpzXCI7XG5cbmNvbnN0IHBvcHVwWm9vbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfaW1hZ2Utem9vbVwiKTtcbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10ZW1wbGF0ZVwiKS5jb250ZW50O1xuY29uc3QgcG9wdXBDYXB0aW9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wb3B1cF9fY2FwdGlvblwiKTtcbmNvbnN0IHBvcHVwUGljdHVyZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfX2ltYWdlXCIpO1xuY29uc3QgZm9ybUVsZW1lbnRBZGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BvcHVwUHJvZmlsZUFkZEJ1dHRvblwiKTtcbmNvbnN0IGRlc2NyaXB0aW9uQWRkRm9ybSA9IHBvcHVwQWRkLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLnBvcHVwX19mb3JtLWZpZWxkW25hbWU9cGxhY2VOYW1lLWlucHV0XVwiXG4pO1xuY29uc3QgbGlua0FkZEZvcm0gPSBwb3B1cEFkZC5xdWVyeVNlbGVjdG9yKFxuICBcIi5wb3B1cF9fZm9ybS1maWVsZFtuYW1lPXBsYWNlVXJsLWlucHV0XVwiXG4pO1xuZXhwb3J0IGZ1bmN0aW9uIHJlbmRlckluaXRpYWxDYXJkcyhjb250YWluZXIsIGpzb24sIG15SWQpIHtcbiAgY29uc3Qgc2VlbklkcyA9IG5ldyBTZXQoKTtcbiAganNvbi5mb3JFYWNoKChjYXJkKSA9PiB7XG4gICAgaWYgKCFzZWVuSWRzLmhhcyhjYXJkW1wiX2lkXCJdKSkge1xuICAgICAgc2Vlbklkcy5hZGQoY2FyZFtcIl9pZFwiXSk7XG4gICAgICBjb250YWluZXIucHJlcGVuZChcbiAgICAgICAgYWRkQ2FyZChcbiAgICAgICAgICBjYXJkLm5hbWUsXG4gICAgICAgICAgY2FyZC5saW5rLFxuICAgICAgICAgIGNhcmRbXCJvd25lclwiXVtcIl9pZFwiXSxcbiAgICAgICAgICBteUlkLFxuICAgICAgICAgIGNhcmRbXCJsaWtlc1wiXSxcbiAgICAgICAgICBjYXJkW1wiX2lkXCJdXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gaGFzTXlMaWtlKG15SWQsIGxpa2VzKSB7XG4gIGNvbnN0IG1hdGNoaW5nTGlrZXMgPSBsaWtlcy5maWx0ZXIoKG9iaikgPT4ge1xuICAgIHJldHVybiBvYmpbXCJfaWRcIl0gPT0gbXlJZDtcbiAgfSk7XG4gIHJldHVybiBtYXRjaGluZ0xpa2VzLmxlbmd0aCA9PT0gMTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFkZENhcmQobmFtZSwgbGluaywgT1dORVJJRCwgbXlJZCwgbGlrZXMsIGNhcmRJZCkge1xuICBjb25zdCBjYXJkRWxlbWVudCA9IGNhcmRUZW1wbGF0ZS5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRcIikuY2xvbmVOb2RlKHRydWUpO1xuICBjb25zdCBsaWtlQnV0dG9uID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19saWtlLWJ1dHRvblwiKTtcbiAgY29uc3QgbGlrZXNDb3VudGVyID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19saWtlLWNvdW50ZXJcIik7XG4gIGxpa2VzQ291bnRlci50ZXh0Q29udGVudCA9IGxpa2VzLmxlbmd0aDtcbiAgaWYgKGhhc015TGlrZShteUlkLCBsaWtlcykpIHtcbiAgICBsaWtlQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJlbGVtZW50X19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gIH1cbiAgbGlrZUJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xuICAgIGlmIChoYXNNeUxpa2UobXlJZCwgbGlrZXMpKSB7XG4gICAgICBkZWxldGVMaWtlKGNhcmRJZClcbiAgICAgICAgLnRoZW4oKHVwZGF0ZWRDYXJkKSA9PiB7XG4gICAgICAgICAgbGlrZXNDb3VudGVyLnRleHRDb250ZW50ID0gdXBkYXRlZENhcmRbXCJsaWtlc1wiXS5sZW5ndGg7XG4gICAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKFwiZWxlbWVudF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgICAgICAgIGxpa2VzID0gdXBkYXRlZENhcmRbXCJsaWtlc1wiXTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDQp9GC0L4t0YLQviDQv9C+0YjQu9C+INC90LUg0YLQsNC6LiDQntGI0LHQuNC60LA6ICR7ZXJyb3J9YCk7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICBwdXRMaWtlKGNhcmRJZClcbiAgICAgICAgLnRoZW4oKHVwZGF0ZWRDYXJkKSA9PiB7XG4gICAgICAgICAgbGlrZXNDb3VudGVyLnRleHRDb250ZW50ID0gdXBkYXRlZENhcmRbXCJsaWtlc1wiXS5sZW5ndGg7XG4gICAgICAgICAgZXZ0LnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKFwiZWxlbWVudF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgICAgICAgIGxpa2VzID0gdXBkYXRlZENhcmRbXCJsaWtlc1wiXTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDQp9GC0L4t0YLQviDQv9C+0YjQu9C+INC90LUg0YLQsNC6LiDQntGI0LHQuNC60LA6ICR7ZXJyb3J9YCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgZGVsZXRlQnRuID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5lbGVtZW50X19kZWxldGUtYnV0dG9uXCIpO1xuICBpZiAobXlJZCA9PSBPV05FUklEKSB7XG4gICAgZGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBuZXdDYXJkID0gZGVsZXRlQnRuLmNsb3Nlc3QoXCIuZWxlbWVudFwiKTtcbiAgICAgIGRlbGV0ZUNhcmQoY2FyZElkKVxuICAgICAgICAudGhlbigoKSA9PiBuZXdDYXJkLnJlbW92ZSgpKVxuICAgICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDQp9GC0L4t0YLQviDQv9C+0YjQu9C+INC90LUg0YLQsNC6LiDQntGI0LHQuNC60LA6ICR7ZXJyfWApO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBkZWxldGVCdG4ucmVtb3ZlKCk7XG4gIH1cblxuICBjb25zdCBpbWFnZSA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuZWxlbWVudF9faW1hZ2VcIik7XG4gIGltYWdlLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gICAgb3BlblBvcHVwKHBvcHVwWm9vbSk7XG4gICAgcG9wdXBQaWN0dXJlLnNyYyA9IGxpbms7XG4gICAgcG9wdXBQaWN0dXJlLmFsdCA9IGDQpNC+0YLQviAke25hbWV9YDtcbiAgICBwb3B1cENhcHRpb24udGV4dENvbnRlbnQgPSBuYW1lO1xuICB9KTtcblxuICBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmVsZW1lbnRfX2luZm9cIikudGV4dENvbnRlbnQgPSBuYW1lO1xuICBpbWFnZS5zcmMgPSBsaW5rO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoXCJhbHRcIiwgYNCk0L7RgtC+ICR7bmFtZX1gKTtcbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuZm9ybUVsZW1lbnRBZGQuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBmdW5jdGlvbiAoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBzd2l0Y2hMb2FkaW5nTWVzZyhldnQuc3VibWl0dGVyLCB0cnVlKTtcbiAgcG9zdE5ld0NhcmQoZGVzY3JpcHRpb25BZGRGb3JtLnZhbHVlLCBsaW5rQWRkRm9ybS52YWx1ZSlcbiAgICAudGhlbigoanNvbikgPT4ge1xuICAgICAgZWxlbWVudHMucHJlcGVuZChcbiAgICAgICAgYWRkQ2FyZChcbiAgICAgICAgICBqc29uW1wibmFtZVwiXSxcbiAgICAgICAgICBqc29uW1wibGlua1wiXSxcbiAgICAgICAgICBqc29uW1wib3duZXJcIl1bXCJfaWRcIl0sXG4gICAgICAgICAganNvbltcIm93bmVyXCJdW1wiX2lkXCJdLFxuICAgICAgICAgIGpzb25bXCJsaWtlc1wiXSxcbiAgICAgICAgICBqc29uW1wiX2lkXCJdXG4gICAgICAgIClcbiAgICAgICk7XG4gICAgICBjbG9zZVBvcHVwKHBvcHVwQWRkKTtcbiAgICAgIGZvcm1FbGVtZW50QWRkLnJlc2V0KCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coYNCn0YLQvi3RgtC+INC/0L7RiNC70L4g0L3QtSDRgtCw0LouINCe0YjQsdC40LrQsDogJHtlcnJ9YCk7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgc3dpdGNoTG9hZGluZ01lc2coZXZ0LnN1Ym1pdHRlciwgZmFsc2UpO1xuICAgICAgfSwgMzAwKTtcbiAgICB9KTtcbn0pO1xuIiwiZnVuY3Rpb24gc2hvd0lucHV0RXJyb3IoXG4gIGZvcm0sXG4gIGlucHV0LFxuICBlcnJvck1lc3NhZ2UsXG4gIHsgaW5wdXRFcnJvckNsYXNzLCBlcnJvckNsYXNzIH1cbikge1xuICBjb25zdCBlcnJvciA9IGZvcm0ucXVlcnlTZWxlY3RvcihgLiR7aW5wdXQuaWR9LWVycm9yYCk7XG4gIGVycm9yLmNsYXNzTGlzdC5hZGQoaW5wdXRFcnJvckNsYXNzKTtcbiAgaW5wdXQuY2xhc3NMaXN0LmFkZChcInBvcHVwX19mb3JtLWZpZWxkX3R5cGVfZXJyb3JcIik7XG4gIGlmIChpbnB1dC52YWx1ZSA9PT0gXCJcIikge1xuICAgIGVycm9yLnRleHRDb250ZW50ID0gXCLQktGLINC/0YDQvtC/0YPRgdGC0LjQu9C4INGN0YLQviDQv9C+0LvQtVwiO1xuICB9IGVsc2Uge1xuICAgIGVycm9yLnRleHRDb250ZW50ID0gZXJyb3JNZXNzYWdlO1xuICB9XG4gIGVycm9yLmNsYXNzTGlzdC5hZGQoZXJyb3JDbGFzcyk7XG59XG5cbmZ1bmN0aW9uIGhpZGVJbnB1dEVycm9yKGZvcm0sIGlucHV0LCB7IGlucHV0RXJyb3JDbGFzcywgZXJyb3JDbGFzcyB9KSB7XG4gIGNvbnN0IGVycm9yID0gZm9ybS5xdWVyeVNlbGVjdG9yKGAuJHtpbnB1dC5pZH0tZXJyb3JgKTtcblxuICBlcnJvci5jbGFzc0xpc3QucmVtb3ZlKGlucHV0RXJyb3JDbGFzcyk7XG4gIGVycm9yLnRleHRDb250ZW50ID0gXCJcIjtcbiAgZXJyb3IuY2xhc3NMaXN0LnJlbW92ZShlcnJvckNsYXNzKTtcbiAgaW5wdXQuY2xhc3NMaXN0LnJlbW92ZShpbnB1dEVycm9yQ2xhc3MpO1xuICBpbnB1dC5jbGFzc0xpc3QucmVtb3ZlKFwicG9wdXBfX2Zvcm0tZmllbGRfdHlwZV9lcnJvclwiKTtcbn1cblxuZnVuY3Rpb24gY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm0sIGlucHV0LCB7IGlucHV0RXJyb3JDbGFzcywgZXJyb3JDbGFzcyB9KSB7XG4gIGlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJmb2N1c1wiLCAoKSA9PiB7XG4gICAgaW5wdXQuc2V0QXR0cmlidXRlKFwiZGF0YS10b3VjaGVkXCIsIHRydWUpO1xuICB9KTtcbiAgaWYgKGlucHV0LmdldEF0dHJpYnV0ZShcImRhdGEtdG91Y2hlZFwiKSAmJiAhaW5wdXQudmFsaWRpdHkudmFsaWQpIHtcbiAgICBzaG93SW5wdXRFcnJvcihmb3JtLCBpbnB1dCwgaW5wdXQudmFsaWRhdGlvbk1lc3NhZ2UsIHtcbiAgICAgIGlucHV0RXJyb3JDbGFzcyxcbiAgICAgIGVycm9yQ2xhc3MsXG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybSwgaW5wdXQsIHsgaW5wdXRFcnJvckNsYXNzLCBlcnJvckNsYXNzIH0pO1xuICB9XG59XG5mdW5jdGlvbiBoYXNJbnZhbGlkSW5wdXQoaW5wdXRzKSB7XG4gIHJldHVybiBBcnJheS5wcm90b3R5cGUuc29tZS5jYWxsKGlucHV0cywgZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgcmV0dXJuIGlucHV0LnZhbGlkaXR5LnZhbGlkID09PSBmYWxzZTtcbiAgfSk7XG59XG5mdW5jdGlvbiBoYXNFbXB0eUlucHV0KGlucHV0cykge1xuICByZXR1cm4gQXJyYXkucHJvdG90eXBlLnNvbWUuY2FsbChpbnB1dHMsIGZ1bmN0aW9uIChpbnB1dCkge1xuICAgIHJldHVybiBpbnB1dC52YWx1ZSA9PT0gXCJcIjtcbiAgfSk7XG59XG5mdW5jdGlvbiB0b2dnbGVTdWJtaXRCdXR0b25TdGF0ZShcbiAgZm9ybSxcbiAgeyBzdWJtaXRCdXR0b25TZWxlY3RvciwgaW5hY3RpdmVCdXR0b25DbGFzcywgaW5wdXRTZWxlY3RvciB9XG4pIHtcbiAgY29uc3QgaW5wdXRzID0gZm9ybS5xdWVyeVNlbGVjdG9yQWxsKGlucHV0U2VsZWN0b3IpO1xuICBjb25zdCBidXR0b25zID0gZm9ybS5xdWVyeVNlbGVjdG9yQWxsKHN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcbiAgaWYgKGhhc0ludmFsaWRJbnB1dChpbnB1dHMpIHx8IGhhc0VtcHR5SW5wdXQoaW5wdXRzKSkge1xuICAgIGJ1dHRvbnMuZm9yRWFjaChmdW5jdGlvbiAoYnV0dG9uKSB7XG4gICAgICBidXR0b24uY2xhc3NMaXN0LmFkZChpbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICAgIGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCB0cnVlKTtcbiAgICB9KTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b25zLmZvckVhY2goZnVuY3Rpb24gKGJ1dHRvbikge1xuICAgICAgYnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUoaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgICBidXR0b24ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIik7XG4gICAgfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gc2V0RXZlbnRMaXN0ZW5lcnMoXG4gIGZvcm0sXG4gIHtcbiAgICBpbnB1dFNlbGVjdG9yLFxuICAgIHN1Ym1pdEJ1dHRvblNlbGVjdG9yLFxuICAgIGluYWN0aXZlQnV0dG9uQ2xhc3MsXG4gICAgZXJyb3JDbGFzcyxcbiAgICBpbnB1dEVycm9yQ2xhc3MsXG4gIH1cbikge1xuICBjb25zdCBpbnB1dHMgPSBBcnJheS5mcm9tKGZvcm0ucXVlcnlTZWxlY3RvckFsbChpbnB1dFNlbGVjdG9yKSk7XG5cbiAgaW5wdXRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsICgpID0+IHtcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtLCBpbnB1dCwgeyBlcnJvckNsYXNzLCBpbnB1dEVycm9yQ2xhc3MgfSk7XG4gICAgICB0b2dnbGVTdWJtaXRCdXR0b25TdGF0ZShmb3JtLCB7XG4gICAgICAgIHN1Ym1pdEJ1dHRvblNlbGVjdG9yLFxuICAgICAgICBpbmFjdGl2ZUJ1dHRvbkNsYXNzLFxuICAgICAgICBpbnB1dFNlbGVjdG9yLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2ZW50KSA9PiB7XG4gICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbmFibGVWYWxpZGF0aW9uKGNvbmZpZykge1xuICBjb25zdCB7IGZvcm1TZWxlY3RvciwgLi4ucmVzdCB9ID0gY29uZmlnO1xuICBjb25zdCBmb3JtcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoZm9ybVNlbGVjdG9yKTtcblxuICBmb3Jtcy5mb3JFYWNoKChmb3JtKSA9PiB7XG4gICAgZm9ybS5zZXRBdHRyaWJ1dGUoXCJub3ZhbGlkYXRlXCIsIHRydWUpO1xuICAgIHNldEV2ZW50TGlzdGVuZXJzKGZvcm0sIHJlc3QpO1xuICAgIHRvZ2dsZVN1Ym1pdEJ1dHRvblN0YXRlKGZvcm0sIHJlc3QpO1xuICB9KTtcbn1cbiIsIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuaW1wb3J0IHtcbiAgb3BlblBvcHVwLFxuICBjbG9zZVBvcHVwLFxuICBlc2NIYW5kbGVyLFxuICBwb3B1cEltYWdlLFxuICBwb3B1cEFkZCxcbn0gZnJvbSBcIi4vY29tcG9uZW50cy9tb2RhbC5qc1wiO1xuaW1wb3J0IHtcbiAgZ2V0SW5pdGlhbENhcmRzLFxuICBnZXRVc2VySW5mb3JtYXRpb24sXG4gIGVkaXRQcm9maWxlSW5mbyxcbiAgcG9zdEF2YXRhcixcbn0gZnJvbSBcIi4vY29tcG9uZW50cy9hcGkuanNcIjtcbmltcG9ydCB7XG4gIHVwZGF0ZVVzZXJJbmZvcm1hdGlvbixcbiAgc3dpdGNoTG9hZGluZ01lc2csXG59IGZyb20gXCIuL2NvbXBvbmVudHMvdXRpbHMuanNcIjtcbmltcG9ydCB7IHJlbmRlckluaXRpYWxDYXJkcyB9IGZyb20gXCIuL2NvbXBvbmVudHMvY2FyZC5qc1wiO1xuaW1wb3J0IHsgZW5hYmxlVmFsaWRhdGlvbiB9IGZyb20gXCIuL2NvbXBvbmVudHMvdmFsaWRhdGUuanNcIjtcbmltcG9ydCB7IGVsZW1lbnRzIH0gZnJvbSBcIi4vY29tcG9uZW50cy9jb25zdGFudHMuanNcIjtcbmNvbnN0IHByb2ZpbGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVcIik7XG5jb25zdCBwcm9maWxlRWRpdEJ1dHRvbiA9IHByb2ZpbGUucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ1dHRvblwiKTtcbmNvbnN0IHBvcHVwRWRpdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucG9wdXBfcHJvZmlsZS1lZGl0XCIpO1xuY29uc3QgcG9wdXBDaGFuZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1jaGFuZ2VcIik7XG5jb25zdCBwb3B1cENoYW5nZUZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBvcHVwX2Zvcm1fbGF5b3V0XCIpO1xuY29uc3QgYWxsUG9wdXAgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucG9wdXBcIikpO1xuY29uc3QgcHJvZmlsZUFkZEJ1dHRvbiA9IHByb2ZpbGUucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnV0dG9uXCIpO1xuY29uc3QgZm9ybUVsZW1lbnRFZGl0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwb3B1cFByb2ZpbGVFZGl0Rm9ybVwiKTtcbmNvbnN0IG5hbWVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZV9fbmFtZS1pbnB1dFwiKTtcbmNvbnN0IGpvYklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlX19kZXNjcmlwdGlvbi1pbnB1dFwiKTtcbmNvbnN0IGlucHV0TmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZV9fbmFtZVwiKTtcbmNvbnN0IGlucHV0RGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xuY29uc3QgcGxhY2VOYW1lSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BsYWNlTmFtZS1pbnB1dFwiKTtcbmNvbnN0IHBsYWNlVXJsSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3BsYWNlVXJsLWlucHV0XCIpO1xuY29uc3QgYXZhdGFyQ2hhbmdlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIucHJvZmlsZV9fYXZhdGFyLWNoYW5nZS1idXR0b25cIlxuKTtcbmNvbnN0IGF2YXRhckltYWdlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG5jb25zdCBwb3B1cEF2YXRhckNoYW5nZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLWNoYW5nZVwiKTtcbmNvbnN0IGF2YXRhckNoYW5nZUlucHV0ID0gcG9wdXBDaGFuZ2VGb3JtLnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLnBvcHVwX19mb3JtLWZpZWxkW25hbWU9cGxhY2VBdmF0YXItY2hhbmdlLWlucHV0XVwiXG4pO1xuXG5jb25zdCBhZGRDYXJkU3VibWl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGRDYXJkU3VibWl0QnRuXCIpO1xuY29uc3QgY2xvc2VCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5wb3B1cF9fY2xvc2UtYnV0dG9uXCIpO1xuXG5nZXRVc2VySW5mb3JtYXRpb24oKS50aGVuKChkYXRhKSA9PiB7XG4gIHVwZGF0ZVVzZXJJbmZvcm1hdGlvbihwb3B1cEltYWdlLCBpbnB1dE5hbWUsIGlucHV0RGVzY3JpcHRpb24sIGRhdGEpO1xuICBjb25zdCBteUlkID0gZGF0YVtcIl9pZFwiXTtcbiAgZ2V0SW5pdGlhbENhcmRzKClcbiAgICAudGhlbigoanNvbikgPT4ge1xuICAgICAgcmVuZGVySW5pdGlhbENhcmRzKGVsZW1lbnRzLCBqc29uLCBteUlkKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhg0KfRgtC+LdGC0L4g0L/QvtGI0LvQviDQvdC1INGC0LDQui4g0J7RiNCx0LjQutCwOiAke2Vycn1gKTtcbiAgICB9KTtcbn0pO1xuY2xvc2VCdXR0b25zLmZvckVhY2goKGJ1dHRvbikgPT4ge1xuICBjb25zdCBwb3B1cCA9IGJ1dHRvbi5jbG9zZXN0KFwiLnBvcHVwXCIpO1xuICBidXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlUG9wdXAocG9wdXApKTtcbn0pO1xuXG5wcm9maWxlRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBvcGVuUG9wdXAocG9wdXBFZGl0KTtcbn0pO1xuYWxsUG9wdXAuZm9yRWFjaCgocG9wdXApID0+IHtcbiAgYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBmdW5jdGlvbiAoZXZ0KSB7XG4gICAgaWYgKGV2dC50YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwicG9wdXBfX29wZW5lZFwiKSkge1xuICAgICAgY2xvc2VQb3B1cChwb3B1cCk7XG4gICAgfVxuICAgIGlmIChldnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcInBvcHVwX19jbG9zZS1idXR0b25cIikpIHtcbiAgICAgIGNsb3NlUG9wdXAocG9wdXApO1xuICAgIH1cbiAgfSk7XG59KTtcbnByb2ZpbGVFZGl0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIG9wZW5Qb3B1cChwb3B1cEVkaXQpO1xuICBuYW1lSW5wdXQudmFsdWUgPSBpbnB1dE5hbWUuaW5uZXJUZXh0O1xuICBqb2JJbnB1dC52YWx1ZSA9IGlucHV0RGVzY3JpcHRpb24uaW5uZXJUZXh0O1xufSk7XG5wb3B1cFByb2ZpbGVFZGl0Rm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGZ1bmN0aW9uIChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIHN3aXRjaExvYWRpbmdNZXNnKGV2dC5zdWJtaXR0ZXIsIHRydWUpO1xuICBlZGl0UHJvZmlsZUluZm8obmFtZUlucHV0LnZhbHVlLCBqb2JJbnB1dC52YWx1ZSlcbiAgICAudGhlbigoanNvbikgPT4ge1xuICAgICAgdXBkYXRlVXNlckluZm9ybWF0aW9uKHBvcHVwSW1hZ2UsIGlucHV0TmFtZSwgaW5wdXREZXNjcmlwdGlvbiwganNvbik7XG4gICAgICBjbG9zZVBvcHVwKHBvcHVwRWRpdCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgY29uc29sZS5sb2coYNCn0YLQvi3RgtC+INC/0L7RiNC70L4g0L3QtSDRgtCw0LouINCe0YjQsdC40LrQsDogJHtlcnJ9YCk7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgc3dpdGNoTG9hZGluZ01lc2coZXZ0LnN1Ym1pdHRlciwgZmFsc2UpO1xuICAgICAgfSwgMzAwKTtcbiAgICB9KTtcbn0pO1xucHJvZmlsZUFkZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBvcGVuUG9wdXAocG9wdXBBZGQpO1xufSk7XG5hdmF0YXJDaGFuZ2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgb3BlblBvcHVwKHBvcHVwQ2hhbmdlKTtcbn0pO1xucG9wdXBBdmF0YXJDaGFuZ2UuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBzd2l0Y2hMb2FkaW5nTWVzZyhldnQuc3VibWl0dGVyLCB0cnVlKTtcbiAgcG9zdEF2YXRhcihhdmF0YXJDaGFuZ2VJbnB1dC52YWx1ZSlcbiAgICAudGhlbigoanNvbikgPT4ge1xuICAgICAgdXBkYXRlVXNlckluZm9ybWF0aW9uKHBvcHVwSW1hZ2UsIGlucHV0TmFtZSwgaW5wdXREZXNjcmlwdGlvbiwganNvbik7XG4gICAgICBjbG9zZVBvcHVwKHBvcHVwQ2hhbmdlKTtcbiAgICAgIGV2dC50YXJnZXQucmVzZXQoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhg0KfRgtC+LdGC0L4g0L/QvtGI0LvQviDQvdC1INGC0LDQui4g0J7RiNCx0LjQutCwOiAke2Vycn1gKTtcbiAgICB9KVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICBzd2l0Y2hMb2FkaW5nTWVzZyhldnQuc3VibWl0dGVyLCBmYWxzZSk7XG4gICAgICB9LCAzMDApO1xuICAgIH0pO1xufSk7XG5cbmNvbnN0IGNvbmZpZyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5wb3B1cF9fZm9ybS1maWVsZFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIucG9wdXBfX2J1dHRvblwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcInBvcHVwX19idXR0b25fbm90QWN0aXZlXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJwb3B1cF9fZXJvci1tYXNhZ2VcIixcbiAgZXJyb3JDbGFzczogXCJwb3B1cF9fZXJvci1tYXNhZ2VfYWN0aXZlXCIsXG59O1xuZW5hYmxlVmFsaWRhdGlvbihjb25maWcpO1xuIl0sIm5hbWVzIjpbInBvcHVwSW1hZ2UiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJwb3B1cEFkZCIsIm9wZW5Qb3B1cCIsImNsaWNrZWRQb3B1cCIsImNsYXNzTGlzdCIsImFkZCIsImFkZEV2ZW50TGlzdGVuZXIiLCJlc2NIYW5kbGVyIiwiY2xvc2VQb3B1cCIsInJlbW92ZSIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJldnQiLCJrZXkiLCJkYXRhIiwiYmFzZVVybCIsImhlYWRlcnMiLCJhdXRob3JpemF0aW9uIiwiZ2V0UmVzRGF0YSIsInJlcyIsIm9rIiwianNvbiIsIlByb21pc2UiLCJyZWplY3QiLCJzdGF0dXMiLCJnZXRJbml0aWFsQ2FyZHMiLCJmZXRjaCIsIm1ldGhvZCIsInRoZW4iLCJzd2l0Y2hMb2FkaW5nTWVzZyIsIkRlc3RpbmF0aW9uIiwiTG9hZGluZyIsInRleHRDb250ZW50IiwiaWQiLCJ1cGRhdGVVc2VySW5mb3JtYXRpb24iLCJhdmF0YXIiLCJuYW1lIiwiYWJvdXQiLCJzcmMiLCJlbGVtZW50cyIsInBvcHVwWm9vbSIsImNhcmRUZW1wbGF0ZSIsImNvbnRlbnQiLCJwb3B1cENhcHRpb24iLCJwb3B1cFBpY3R1cmUiLCJmb3JtRWxlbWVudEFkZCIsImRlc2NyaXB0aW9uQWRkRm9ybSIsImxpbmtBZGRGb3JtIiwiaGFzTXlMaWtlIiwibXlJZCIsImxpa2VzIiwiZmlsdGVyIiwib2JqIiwibGVuZ3RoIiwiYWRkQ2FyZCIsImxpbmsiLCJPV05FUklEIiwiY2FyZElkIiwiY2FyZEVsZW1lbnQiLCJjbG9uZU5vZGUiLCJsaWtlQnV0dG9uIiwibGlrZXNDb3VudGVyIiwiZGVsZXRlTGlrZSIsInVwZGF0ZWRDYXJkIiwidGFyZ2V0IiwidG9nZ2xlIiwiY2F0Y2giLCJlcnJvciIsImNvbnNvbGUiLCJsb2ciLCJwdXRMaWtlIiwiZGVsZXRlQnRuIiwibmV3Q2FyZCIsImNsb3Nlc3QiLCJkZWxldGVDYXJkIiwiZXJyIiwiaW1hZ2UiLCJhbHQiLCJzZXRBdHRyaWJ1dGUiLCJwcmV2ZW50RGVmYXVsdCIsInN1Ym1pdHRlciIsInZhbHVlIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJyZXNldCIsImZpbmFsbHkiLCJzZXRUaW1lb3V0IiwidG9nZ2xlU3VibWl0QnV0dG9uU3RhdGUiLCJmb3JtIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRTZWxlY3RvciIsImlucHV0cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJidXR0b25zIiwiQXJyYXkiLCJwcm90b3R5cGUiLCJzb21lIiwiY2FsbCIsImlucHV0IiwidmFsaWRpdHkiLCJ2YWxpZCIsImhhc0ludmFsaWRJbnB1dCIsImhhc0VtcHR5SW5wdXQiLCJmb3JFYWNoIiwiYnV0dG9uIiwicmVtb3ZlQXR0cmlidXRlIiwiY29uZmlnIiwiZm9ybVNlbGVjdG9yIiwicmVzdCIsInByb2ZpbGUiLCJwcm9maWxlRWRpdEJ1dHRvbiIsInBvcHVwRWRpdCIsInBvcHVwQ2hhbmdlIiwicG9wdXBDaGFuZ2VGb3JtIiwiYWxsUG9wdXAiLCJmcm9tIiwicHJvZmlsZUFkZEJ1dHRvbiIsIm5hbWVJbnB1dCIsImpvYklucHV0IiwiaW5wdXROYW1lIiwiaW5wdXREZXNjcmlwdGlvbiIsImF2YXRhckNoYW5nZUJ0biIsInBvcHVwQXZhdGFyQ2hhbmdlIiwiYXZhdGFyQ2hhbmdlSW5wdXQiLCJjbG9zZUJ1dHRvbnMiLCJjb250YWluZXIiLCJzZWVuSWRzIiwiU2V0IiwiY2FyZCIsImhhcyIsInByZXBlbmQiLCJyZW5kZXJJbml0aWFsQ2FyZHMiLCJwb3B1cCIsImNvbnRhaW5zIiwiaW5uZXJUZXh0IiwicG9wdXBQcm9maWxlRWRpdEZvcm0iLCJhdmF0YXJMaW5rIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImdldEF0dHJpYnV0ZSIsImVycm9yTWVzc2FnZSIsInNob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJoaWRlSW5wdXRFcnJvciIsImNoZWNrSW5wdXRWYWxpZGl0eSIsImV2ZW50Iiwic2V0RXZlbnRMaXN0ZW5lcnMiXSwic291cmNlUm9vdCI6IiJ9